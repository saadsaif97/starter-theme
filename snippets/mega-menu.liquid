{%- assign menu_1 = block.settings.menu_1 -%}
{%- assign menu_2 = block.settings.menu_2 -%}

<div class="mega-menu" id="{{ block.id }}" {{ block.shopify_attributes }}>
  <div class="mega-columns">
    {%- if menu_1 != blank -%}
      <div class="column">
        <h4>{{ menu_1.title }}</h4>
        <ul>
          {%- for m1_link in menu_1.links -%}
            <li>
              <a href="{{ m1_link.title }}">{{ m1_link.title }}</a>
            </li>
          {%- endfor -%}
        </ul>
      </div>
    {%- endif -%}
    {%- if menu_2 != blank -%}
      <div class="column">
        <h4>{{ menu_2.title }}</h4>
        <ul>
          {%- for m2_link in menu_2.links -%}
            <li>
              <a href="{{ m2_link.title }}">{{ m2_link.title }}</a>
            </li>
          {%- endfor -%}
        </ul>
      </div>
    {%- endif -%}
  </div>
  {%- if block.settings.image != blank -%}
    <div class="mega-banner">
      <a href="{{ block.settings.image_url }}">
        <img src="{{ block.settings.image |  image_url: width: 500 }}" alt="Promo Banner">
      </a>
    </div>
  {%- endif -%}
</div>

{%- if request.design_mode -%}
  <script>
    document.addEventListener('shopify:block:select', function (e) {
      console.log('shopify:block:select', e);
      const blockEl = document.getElementById(e.detail.blockId);
      if (blockEl) {
        blockEl.classList.add('force-show');
      }
    });

    document.addEventListener('shopify:block:deselect', function (e) {
      console.log('shopify:block:deselect', e);
      const blockEl = document.getElementById(e.detail.blockId);
      if (blockEl) {
        blockEl.classList.remove('force-show');
      }
    });
  </script>
{%- endif -%}

<style>
  /* Mega Menu */
  .mega-menu {
    position: absolute;
    top: 100%;
    left: 0;
    width: 100vw;
    background-color: #f9f9f9;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    padding: 2rem;
    gap: 2rem;

    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition: opacity 1s ease;
  }

  .menu-item:hover .mega-menu,
  .menu-item .mega-menu:hover {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    display: flex;
  }

  .mega-menu::before {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    top: -30px;
  }

  .mega-columns {
    display: flex;
    gap: 2rem;
    flex: 1 1 60%;
  }

  .column h4 {
    margin-bottom: 0.5rem;
    font-size: 1rem;
    color: #111;
  }

  .column ul {
    list-style: none;
  }

  .column ul li {
    margin-bottom: 0.5rem;
  }

  .mega-menu.force-show {
    opacity: 1 !important;
    visibility: visible !important;
    pointer-events: auto !important;
    display: flex !important;
  }

  .column ul li a {
    color: #555;
    text-decoration: none;
    font-size: 0.95rem;
  }

  .column ul li a:hover {
    text-decoration: underline;
  }

  /* Banner */
  .mega-banner {
    flex: 1 1 40%;
  }

  .mega-banner img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 8px;
  }
</style>
